machine:
  environment:
    SBT_VERSION: 0.13.12
    SBT_OPTS: "-Xms512M -Xmx2048M -Xss1M -XX:+CMSClassUnloadingEnabled"
    _JAVA_OPTIONS: "-Xms512m -Xmx2048m -Xss1M -XX:+CMSClassUnloadingEnabled"
  java:
    version: oraclejdk8

dependencies:
  cache_directories:
    - "~/.ivy2/cache"
    - "~/.sbt/boot"
  pre:
    - find ~/.sbt -name "*.lock" | xargs -r rm
    - find ~/.ivy2 -name "ivydata-*.properties" | xargs -r rm
    - scripts/publishLocalScoverageJava.sh
    - scripts/publishLocalScoverage.sh
    - scripts/publishLocalSbtScoverage.sh 
  override:
    - java -XX:+PrintFlagsFinal -version
    - sbt -sbt-version $SBT_VERSION coverage test:compile

test:
  override: 
    - sbt -sbt-version $SBT_VERSION coverage test
    - sbt -sbt-version $SBT_VERSION coverageReport
    - sbt -sbt-version $SBT_VERSION coverageAggregate
